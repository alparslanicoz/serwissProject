{"version":3,"file":"context-menu.component.js","sourceRoot":"","sources":["../../../src/lib/context-menu/context-menu.component.ts"],"names":[],"mappings":"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","sourcesContent":["\nimport {\n  AfterContentInit,\n  ChangeDetectorRef,\n  Component,\n  ContentChildren,\n  EventEmitter,\n  HostListener,\n  Inject,\n  Input,\n  Optional,\n  Output,\n  QueryList,\n} from '@angular/core';\nimport { ContextMenuService, IContextMenuClickEvent } from './context-menu.service';\nimport { ContextMenuItemDirective } from './context-menu.item.directive';\n\nexport interface ILinkConfig {\n  click: (item: any, $event?: MouseEvent) => void;\n  enabled?: (item: any) => boolean;\n  html: (item: any) => string;\n}\n\n@Component({\n  selector: 'context-menu',\n  styles:  [ ] ,\n  template:\n  `<div class=\"dropdown angular2-contextmenu\">\n      <ul *ngIf=\"item\" [ngStyle]=\"locationCss\" class=\"dropdown-menu\">\n        <!-- Imperative context menu -->\n        <li *ngFor=\"let link of links\" [class.disabled]=\"isDisabled(link)\">\n          <a href [class.disabled]=\"isDisabled(link)\"\n            (click)=\"execute(link, $event); $event.preventDefault(); $event.stopPropagation();\"\n            innerHTML=\"{{link.html ? link.html(item) : ''}}\"></a>\n        </li>\n        <!-- Declarative context menu -->\n        <li *ngFor=\"let menuItem of visibleMenuItems\" [class.disabled]=\"!isMenuItemEnabled(menuItem)\"\n          [attr.role]=\"menuItem.divider ? 'separator' : undefined\" [class.divider]=\"menuItem.divider\">\n          <a *ngIf=\"!menuItem.divider\" href \n            [class.disabled]=\"!isMenuItemEnabled(menuItem)\"\n            (click)=\"menuItem.triggerExecute(item, $event); $event.preventDefault(); $event.stopPropagation();\">\n            <template [ngTemplateOutlet]=\"menuItem.template\" [ngOutletContext]=\"{ $implicit: item }\"></template>\n          </a>\n        </li>\n      </ul>\n    </div>\n  `,\n})\nexport class ContextMenuComponent implements AfterContentInit {\n  @Output() public close: EventEmitter<any> = new EventEmitter<any>();\n  @ContentChildren(ContextMenuItemDirective) public menuItems: QueryList<ContextMenuItemDirective>;\n  public visibleMenuItems: ContextMenuItemDirective[] = [];\n\n  public links: ILinkConfig[] = [];\n  public isShown: boolean = false;\n  public isOpening: boolean = false;\n  public item: any;\n  private mouseLocation: { left: number, top: number } = { left: 0, top: 0 };\n  constructor(\n    private _contextMenuService: ContextMenuService,\n    private changeDetector: ChangeDetectorRef,   \n  ) {   \n    _contextMenuService.show.subscribe(menuEvent => this.onMenuEvent(menuEvent));\n  }\n\n  get locationCss(): any {\n    return {\n      'position': 'fixed',\n      'display': this.isShown ? 'block' : 'none',\n      left: this.mouseLocation.left + 'px',\n      top: this.mouseLocation.top + 'px',\n    };\n  }\n\n  @HostListener('document:click')\n  @HostListener('document:contextmenu')\n  public clickedOutside(): void {\n    if (!this.isOpening) {\n      this.hideMenu();\n    }\n  }\n\n  public ngAfterContentInit(): void {\n    this.menuItems.forEach(menuItem => {\n      menuItem.execute.subscribe(() => this.hideMenu());\n    });\n  }\n\n  public isMenuItemEnabled(menuItem: ContextMenuItemDirective): boolean {\n    return this.evaluateIfFunction(menuItem.enabled);\n  }\n\n  public isMenuItemVisible(menuItem: ContextMenuItemDirective): boolean {\n    return this.evaluateIfFunction(menuItem.visible);\n  }\n\n  public evaluateIfFunction(value: any): any {\n    if (value instanceof Function) {\n      return value(this.item);\n    }\n    return value;\n  }\n\n  public isDisabled(link: ILinkConfig): boolean {\n    return link.enabled && !link.enabled(this.item);\n  }\n\n  public execute(link: ILinkConfig, $event?: MouseEvent): void {\n    if (this.isDisabled(link)) {\n      return;\n    }\n    this.hideMenu();\n    link.click(this.item, $event);\n  }\n\n  public onMenuEvent(menuEvent: IContextMenuClickEvent): void {\n    let { actions, contextMenu, event, item } = menuEvent;\n    if (contextMenu && contextMenu !== this) {\n      this.hideMenu();\n      return;\n    }\n    this.isOpening = true;\n    setTimeout(() => this.isOpening = false, 400);\n    if (actions) {\n      if (console && console.warn) {\n        console.warn(`actions configuration object is deprecated and will be removed in version 1.x.\n        See https://github.com/isaacplmann/angular2-contextmenu for the new declarative syntax.`);\n      }\n    }\n    if (actions && actions.length > 0) {\n      // Imperative context menu\n      this.setVisibleMenuItems();\n      this.showMenu();\n    } else if (this.menuItems) {\n      // Declarative context menu\n      setTimeout(() => {\n        this.setVisibleMenuItems();\n        if (this.visibleMenuItems.length > 0) {\n          this.showMenu();\n        } else {\n          this.hideMenu();\n        }\n      });\n    } else {\n      this.hideMenu();\n    }\n    this.links = actions;\n    this.item = item;\n    this.mouseLocation = {\n      left: event.clientX,\n      top: event.clientY,\n    };\n  }\n\n  public setVisibleMenuItems(): void {\n    this.visibleMenuItems = this.menuItems.filter(menuItem => this.isMenuItemVisible(menuItem));\n  }\n\n  public showMenu(): void {\n    this.isShown = true;\n    this.changeDetector.markForCheck();\n  }\n\n  public hideMenu(): void {\n    if (this.isShown === true) {\n      this.close.emit({});\n    }\n    this.isShown = false;\n    this.changeDetector.markForCheck();\n  }\n}"]}